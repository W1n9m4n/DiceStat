<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DiceStat</title>
  <style>
    body { font-family: sans-serif; max-width: 480px; margin: 2em auto; padding: 0 1em; }
    button, input { font-size: 1em; margin: 0.5em 0; }
    #results { margin-top: 1em; }
    #results ul { padding-left: 1.2em; }
  </style>
</head>
<body>

  <h1>DiceStat</h1>
  <p>Capture a photo of your dice and get instant stats!</p>

  <!-- File input that invokes the camera on mobile -->
  <input type="file" accept="image/*" capture="environment" id="fileInput" />

  <!-- Or you could wire up getUserMedia for a live preview if you prefer -->

  <button id="analyzeBtn" disabled>Analyze Dice</button>

  <div id="results"></div>

  <!-- Axios from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    const fileInput = document.getElementById('fileInput');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const resultsDiv = document.getElementById('results');

    let base64Image = '';

    // Read selected file as Base64
    fileInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        base64Image = reader.result.split(',')[1];  // strip off data:image/...;base64,
        analyzeBtn.disabled = false;
      };
      reader.readAsDataURL(file);
    });

    analyzeBtn.addEventListener('click', async () => {
      if (!base64Image) return;
      resultsDiv.innerHTML = '<p>Analyzingâ€¦</p>';

      try {
        const response = await axios.post(
          'https://serverless.roboflow.com/dice-9uzag/3',
          base64Image,
          {
            params: { api_key: 'hcMpxDXEVyytWxlYcR00' },
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
          }
        );

        const preds = response.data.predictions || [];
        // Extract the integer label for each detected die
        const diceValues = preds.map(p => Number(p.class)); 
        const count = diceValues.length;
        const total = diceValues.reduce((sum,v) => sum+v, 0);

        // Display
        resultsDiv.innerHTML = `
          <h2>Results</h2>
          <ul>
            <li><strong>Number of dice:</strong> ${count}</li>
            <li><strong>Total sum:</strong> ${total}</li>
            <li><strong>Individual rolls:</strong>
              <ul>
                ${diceValues.map(v => `<li>${v}</li>`).join('')}
              </ul>
            </li>
          </ul>
        `;
      } catch (err) {
        console.error(err);
        resultsDiv.innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
      }
    });
  </script>
</body>
</html>
